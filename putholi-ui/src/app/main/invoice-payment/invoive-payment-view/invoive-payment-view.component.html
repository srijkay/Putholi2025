<!-- Page header -->
<div class="page-header page-header-light">
    <div class="page-header-content header-elements-lg-inline">
        <div class="page-title d-flex">
            <h4> <i class="icon-arrow-left52 mr-2"></i> <span
                    class="font-weight-semibold">{{'COMMON.Home'|translate}}</span> -
                {{'INVOICEPAYMENT.ViewPaymentInvoice'|translate}}</h4>
            <a href="javascript:;" class="header-elements-toggle text-body d-lg-none"><i class="icon-more"></i></a>
        </div>
    </div>

    <div class="breadcrumb-line breadcrumb-line-light header-elements-lg-inline">
        <div class="d-flex">
            <div class="breadcrumb">
                <a href="javascript:;" [routerLink]="['/main/dashboard']" class="breadcrumb-item"><i
                        class="icon-home2 mr-2"></i>
                    {{'COMMON.Home'|translate}}</a>
                <a href="javascript:;" [routerLink]="['/main/invoice-payment/invoice-payment-list']"
                    class="breadcrumb-item">{{'SIDEBAR.InvoicePayment'|translate}}</a>
                <span class="breadcrumb-item active">{{'INVOICEPAYMENT.ViewPaymentInvoice'|translate}}</span>
            </div>
            <a href="javascript:;" class="header-elements-toggle text-body d-lg-none"><i class="icon-more"></i></a>
        </div>
    </div>
</div>
<!-- /page header -->

<!-- Content area -->
<div class="content">
    <div class="card">
        <!-- Card Header -->
        <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="fs-17 font-weight-600 mb-0">{{'INVOICEPAYMENT.ViewPaymentInvoice'|translate}}
                    </h6>
                </div>
            </div>
        </div>
        <!-- /Card Header -->
        <br>

        <!-- Form -->
        <form class="form-horizontal" (ngSubmit)="onSubmitExpenses(expensesDetailForm,expensesDetailData)"
            #expensesDetailForm="ngForm">
            <!-- Card Body -->
            <div class="card-body">

                <!-- row -->
                <div class="form-group row">
                    <!-- label for UTR Number -->
                    <!-- <label
                        class="col-lg-2 col-sm-12 col-form-label font-weight-600">{{'INVOICEPAYMENT.UTRNumber'|translate}}
                        :</label>
                    <div class="col-md-4">
                        <p>{{expenseList?.utrNumber}}</p>
                    </div> -->

                    <!-- label for beneficiary name -->
                    <label
                        class="col-lg-2 col-sm-12 col-form-label font-weight-600">{{'INVOICEPAYMENT.BeneficiaryName'|translate}}
                        :</label>
                    <div class="col-md-4">
                        <p>{{expenseList?.vendorName}}</p>
                    </div>

                    <!-- label for phone Number -->
                    <label
                        class="col-lg-2 col-sm-12 col-form-label font-weight-600">{{'INVOICEPAYMENT.PhoneNumber'|translate}}
                        :</label>
                    <div class="col-md-4">
                        <p>{{expenseList?.mobileNumber}}</p>
                    </div>

                </div>
                <!-- /row -->

                <!-- row -->
                <div class="form-group row">
                    <!-- label for Description -->
                    <label
                        class="col-lg-2 col-sm-12 col-form-label font-weight-600">{{'INVOICEPAYMENT.Category'|translate}}<span
                            class=""> :</span></label>
                    <div class="col-md-4">
                        <p>{{expenseList?.category?.description}}</p>
                    </div>

                    <!-- label for Others -->
                    <label *ngIf="expenseList?.category == 'OTHR'"
                        class="col-lg-2 col-sm-12 col-form-label font-weight-600">{{'INVOICEPAYMENT.Others'|translate}}<span
                            class=""> :</span></label>
                    <div class="col-md-4" *ngIf="expenseList?.category == 'OTHR'">
                        <p>{{expenseList?.other}}</p>
                    </div>

                    <!-- label for beneficiary bank name -->
                    <label
                        class="col-lg-2 col-sm-12 col-form-label font-weight-600">{{'INVOICEPAYMENT.BankName'|translate}}
                        :</label>
                    <div class="col-md-4">
                        <p>{{expenseList?.bankName?.description}}</p>
                    </div>
                </div>
                <!-- /row -->

                <!-- row -->
                <div class="form-group row">
                    <!-- label for account number -->
                    <label
                        class="col-lg-2 col-sm-12 col-form-label font-weight-600">{{'INVOICEPAYMENT.AccountNumber'|translate}}
                        :</label>
                    <div class="col-md-4">
                        <p>{{expenseList?.accountNum}}</p>
                    </div>

                    <!-- label for ifsc code -->
                    <label
                        class="col-lg-2 col-sm-12 col-form-label font-weight-600">{{'INVOICEPAYMENT.IFSCCode'|translate}}
                        :</label>
                    <div class="col-md-4">
                        <p>{{expenseList?.ifscCode}}</p>
                    </div>
                </div>
                <!-- /row -->

                <!-- row -->
                <div class="form-group row">
                    <!-- label for PaymentDate date -->
                    <label
                        class="col-lg-2 col-sm-12 col-form-label font-weight-600">{{'INVOICEPAYMENT.PaymentDate'|translate}}
                        :</label>
                    <div class="col-md-4">
                        <p>{{expenseList?.transactionDate | date:'dd/MM/yyyy'}}</p>
                    </div>

                    <!-- label for amount -->
                    <label
                        class="col-lg-2 col-sm-12 col-form-label font-weight-600">{{'INVOICEPAYMENT.Amount'|translate}}
                        :</label>
                    <div class="col-md-4">
                        <p>{{expenseList?.amount}}</p>
                    </div>
                </div>
                <!-- /row -->

                <!-- row -->
                <div class="form-group row">
                    <!-- label for amount -->
                    <label
                        class="col-lg-2 col-sm-12 col-form-label font-weight-600">{{'INVOICEPAYMENT.Address'|translate}}
                        :</label>
                    <div class="col-md-4">
                        <p>{{expenseList?.address}}</p>
                    </div>

                    <!-- label for Comments -->
                    <label
                        class="col-lg-2 col-sm-12 col-form-label font-weight-600">{{'INVOICEPAYMENT.Comments'|translate}}<span
                            class=""> :</span></label>
                    <div class="col-md-4">
                        <p>{{expenseList?.description}}</p>
                    </div>
                </div>
                <!-- /row -->

                <!-- row -->
                <div class="form-group row">
                    <!-- label for utr number -->
                    <label *ngIf="expenseList?.utrNumber !=0"
                        class="col-lg-2 col-sm-12 col-form-label font-weight-600">{{'INVOICEPAYMENT.UTRNumber'|translate}}
                        :</label>
                    <div class="col-lg-4" *ngIf="expenseList?.utrNumber !=0">
                        <p>{{expenseList?.utrNumber}}</p>
                    </div>

                    <!-- label for utr date -->
                    <label *ngIf="expenseList?.utrDate"
                        class="col-lg-2 col-sm-12 col-form-label font-weight-600">{{'INVOICEPAYMENT.UTRDate'|translate}}<span
                            class=""> :</span></label>
                    <div class="col-lg-4" *ngIf="expenseList?.utrDate">
                        <p>{{expenseList?.utrDate| date:'dd/MM/yyyy'}}</p>
                    </div>
                </div>
                <!-- /row -->

                <!-- row -->
                <div class="form-group row" *ngIf="expenseList?.rejectedReason">
                    <!-- label for amount -->
                    <label class="col-lg-2 col-sm-12 col-form-label font-weight-600">
                        {{'INVOICEPAYMENT.RejectedReason'|translate}}
                        <span class=""> :</span></label>
                    <div class="col-md-4">
                        <p>{{expenseList?.rejectedReason}}</p>
                    </div>
                </div>
                <!-- /row -->

                <!-- row -->
                <div class="form-group row">
                    <!-- label for view picture -->
                    <label class="col-lg-2 col-sm-12 col-form-label font-weight-600">{{'MANAGESCHOOL.ViewPicture' |
                        translate}} :</label>
                    <div class="col-lg-4 col-md-12 col-sm-12">
                        <button type="button" href="javascript:;"
                            (click)="onInvoiceImage(images,expenseList?.expensesId)" data-toggle="modal"
                            class="btn btn-info">{{'COMMON.ClickHeretoViewImages' |
                            translate}}</button>
                    </div>

                    <!-- label for  Update Payment Info -->
                    <label class="col-lg-2 col-sm-12 col-form-label font-weight-600"
                        *ngIf="expenseList?.status =='PAYINI'">
                        Update Payment Info :</label>
                    <div class="col-lg-4 col-md-12 col-sm-12" *ngIf="expenseList?.status =='PAYINI'">
                        <button type="button" data-toggle="modal" class="btn btn-info"
                            (click)="uploadPaymentInfo(paymentTemplate)">
                            Update Payment Info</button>
                    </div>
                </div>
                <!-- /row -->

                <!-- Approval -->
                <h5>{{'COMMON.ApprovalHistory' | translate }}</h5>
                <hr />
                <div class="table-responsive">
                    <table class="table table-bordered" id="tempTable">
                        <thead>
                            <tr>
                                <th>{{'COMMON.ActionBy' | translate }}</th>
                                <th>{{'COMMON.ActionDate&Time' | translate }}</th>
                                <th>{{'MANAGEUSER.Role'|translate}}</th>
                                <th>{{'COMMON.Status' | translate }}</th>
                                <th>{{'COMMON.Remarks' | translate }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="odd gradeX" *ngFor="let data of approvalHistDtlsDTOs">
                                <td>{{data?.actionBy}}</td>
                                <td>{{data?.actionDate |date:'dd/MM/yyyy hh:mm:ss'}}</td>
                                <td>{{data?.role}}</td>
                                <td *ngIf="data?.status =='APR'"><span class="badge badge-success">Approved</span>
                                </td>
                                <td *ngIf="data?.status =='REJ'"><span class="badge badge-danger">Rejected</span>
                                </td>
                                <td>{{data?.remarks}}</td>
                            </tr>
                            <tr class="odd" *ngIf="(!approvalHistDtlsDTOs?.length)">
                                <td style="text-align: center" colspan="10" class="dataTables_empty"><b>
                                        {{'RECORDS.NoRecords'|translate}}</b>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div *ngIf="this.getToken('role')!='ADMIN'">
                    <h5>{{'MANAGESCHOOL.Approval' | translate }}</h5>
                    <hr />

                    <div class="form-group row">
                        <label class="col-lg-2 col-sm-12 col-form-label font-weight-600">{{'COMMON.Status'|translate}}
                            <span class="required"> *</span></label>
                        <div class="form-inline col-md-3" style="margin-bottom: 9px;">
                            <div class="custom-control custom-radio custom-control-inline">
                                <input type="radio" id="customRadio1" #status="ngModel"
                                    [(ngModel)]="expensesDetailData.status" value="APR" name="customRadio"
                                    class="custom-control-input" required>
                                <label class="custom-control-label" for="customRadio1">{{'COMMON.Approve' | translate
                                    }}</label>
                            </div>
                            <div class="custom-control custom-radio custom-control-inline">
                                <input type="radio" id="customRadio2" #status="ngModel"
                                    [(ngModel)]="expensesDetailData.status" value="REJ" name="customRadio"
                                    class="custom-control-input" required>
                                <label class="custom-control-label" for="customRadio2">{{'COMMON.Reject' | translate
                                    }}</label>
                            </div>
                            <div class="error-block" *ngIf="(status.touched && status.invalid)">
                                This field cannot be left blank
                            </div>
                        </div>
                    </div>

                    <div class="form-group row">

                        <label class="col-lg-2 col-sm-12 col-form-label font-weight-600">{{'COMMON.Remarks' | translate
                            }}<span class="required"> *</span></label>
                        <div class="col-lg-4 col-sm-12 col-form-label">
                            <app-nspl-multiline-text [data]="expensesDetailData.remarks"
                                [(ngModel)]="expensesDetailData.remarks" [required]="true" [maxlength]="'512'"
                                placeholder="{{'COMMON.EnterRemarks'|translate}}" name="remarks">
                            </app-nspl-multiline-text>

                        </div>
                    </div>
                </div>
                <!-- Form -->
            </div>
            <!-- Card Body -->

            <!-- Card Footer -->
            <div class="card-footer">
                <button type="submit" *ngIf="this.getToken('role') !='ADMIN'"
                    class="btn btn-primary">{{'COMMON.Submit'|translate}}</button>&nbsp;&nbsp;

                <button [routerLink]="['/main/invoice-payment/invoice-payment-list']" type="button"
                    class="btn btn-danger">{{'COMMON.Cancel'|translate}}</button>
            </div>
            <!-- Card Footer -->
        </form>
    </div>
</div>
<!-- /Content area -->

<!-- show Invoice Images-->
<ng-template #images>

    <div class="modal-header">

        <h4 class="modal-title">{{'INVOICEPAYMENT.ViewInvoicePaymentImages' | translate}}</h4>

        <button type="button" class="close pull-right" aria-label="Close" (click)="closeImageModal() ">
            <span aria-hidden="true">&times;</span>
        </button>

    </div>

    <div class="modal-body">
        <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner">
                <div class="carousel-item active" *ngIf="base64Image">
                    <img class="d-block w-100" [src]="transform()" alt="First slide" style="height: 500px;">
                </div>
            </div>

            <div class="carousel-inner" *ngIf="!base64Image">
                <iframe [src]="transform()" width="100%" height="500px"></iframe>
            </div>
        </div>
    </div>
</ng-template>
<!-- /show Invoice Images-->



<!-- open modal for View Invoice -->
<div bsModal #paymentTemplate="bs-modal" class="modal fade" tabindex="-1" role="dialog"
    aria-labelledby="mySmallModalLabel" aria-hidden="true" [config]="{backdrop:'static', keyboard:false}">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">{{'INVOICEPAYMENT.UpdatePaymentDetails'|translate}}</h4>
                <button type="button" class="close pull-right" aria-label="Close" (click)="uploadPayRef.hide()">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <form class="form-horizontal" (ngSubmit)="submitUploadPayForm(paymentInfoForm,uploadPaymentData, success)"
                #paymentInfoForm="ngForm">
                <div class="modal-body ">

                    <!-- row -->
                    <div class="form-group row">
                        <label class="col-lg-2 col-sm-12 col-form-label font-weight-600">
                            {{'COMMON.Status'|translate}} <span class="required"> *</span></label>
                        <div class="col-lg-4 col-md-12 col-sm-12">
                            <app-nspl-file-browse [data]="uploadImage" [required]="true" [(ngModel)]="uploadImage"
                                name="uploadImage" [isErrorMsg]="false" [maxlength]="'1'" [accept]="'xls, .xlsx'"
                                [allowedExtensions]="['.xlsx', '.xls']">
                            </app-nspl-file-browse>
                        </div>

                    </div>
                    <!-- /row -->


                </div>

                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary" data-dismiss="modal"
                        [disabled]="paymentInfoForm.invalid">{{'COMMON.Submit'|translate}}</button>

                    <button type="button" class="btn btn-danger" data-dismiss="modal"
                        (click)="uploadPayRef.hide()">{{'COMMON.Cancel'|translate}}</button>
                </div>
            </form>
        </div>
    </div>
</div>

<ng-template #success>
    <div class="centered">
        <div class="check"><i class="fa fa-check" aria-hidden="true"></i></div>
        <div class="content">
            <h3>{{invoiceResponse?.apiStatusDesc}}</h3>
            <div class="modal-body">
                <p class="text-center">
                    Total Records are: <b>{{invoiceResponse?.id}}</b><br />
                    Success Records are: <b>{{invoiceResponse?.successCount}}</b><br />
                    Failure Records are : <b>{{invoiceResponse?.failureCount}}</b><br/>
                    <span *ngIf="invoiceResponse.refNo!=null">{{invoiceResponse.refNo}}</span>
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success btn-block" data-dismiss="modal" (click)="closeModel()">Ok</button>
            </div>
        </div>
    </div>
</ng-template>